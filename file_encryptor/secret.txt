from PIL import Image
import numpy as np
import io

# Inject the Secret File into an Image (PNG)
def png_file_injector():
    file_to_hide = 'secret.txt'
    image = Image.open('Image.png')
    width, height = image.size
    img_arr = np.array(list(image.getdata()))

    if image.mode == "P":
        print("Not supported")
        exit()

    channels = 4 if image.mode == 'RGBA' else 3

    pixels = img_arr.size // channels

    stop_indicator = "$NEURAL$"
    stop_indicator_length = len(stop_indicator)

    # Read the contents of the file
    with open(file_to_hide, 'rb') as file:
        file_data = file.read()

    # Convert file data to binary
    byte_message = ''.join(f"{byte:08b}" for byte in file_data)
    bits = len(byte_message)

    if bits > pixels:
        print("Not enough space")
    else:
        index = 0
        for i in range(pixels):
            for j in range(0, 3):
                if index < bits:
                    img_arr[i][j] = int(bin(img_arr[i][j])[2:-1] + byte_message[index], 2)
                    index += 1

    img_arr = img_arr.reshape((height, width, channels))
    result = Image.fromarray(img_arr.astype('uint8'), image.mode)
    result.save('encoded.png')

# Decoding the Secret File from an Image (PNG format)
def png_file_decoder():
    image = Image.open('encoded.png')
    img_arr = np.array(list(image.getdata()))
    channels = 4 if image.mode == 'RGBA' else 3
    pixels = img_arr.size // channels

    secret_bits = [bin(img_arr[i][j])[-1] for i in range(pixels) for j in range(0, 3)]
    secret_bits = [secret_bits[i:i+8] for i in range(0, len(secret_bits), 8)]

    # Convert binary data to bytes
    file_data = bytes([int(''.join(bits), 2) for bits in secret_bits])

    with open('decoded.txt', 'wb') as file:
        file.write(file_data)

    print("File decoded and saved as 'decoded.txt'")

def main():
    png_file_injector()
    png_file_decoder()

main()




e_from_jpg():
    # Reading the content of the modified photo.jpg file
    with open("photo.jpg", 'rb') as f:
        content = f.read()

        # Finding the offset of the end marker in the JPEG file (FFD9)
        offset = content.index(bytes.fromhex('FFD9'))

        # Seeking to the position after the end marker
        f.seek(offset + 2)

        # Creating a new image from the remaining data and saving it as new.png
        new_image = Image.open(io.BytesIO(f.read()))
        new_image.save("new.png")

def append_exe_to_jpg():
    # Injecting an EXE file into the photo.jpg file
    with open('photo.jpg', 'ab') as f, open('file.exe', 'rb') as e:
        f.write(e.read())

def decode_exe_from_jpg():
    # Reading the content of the modified photo.jpg file
    with open("photo.jpg", 'rb') as f:
        content = f.read()

        # Finding the offset of the end marker in the JPEG file (FFD9)
        offset = content.index(bytes.fromhex('FFD9'))

        # Seeking to the position after the end marker
        f.seek(offset + 2)

        # Creating a new file new_file.exe from the injected data
        with open('new_file.exe', 'wb') as e:
            e.write(f.read())

def main():
    png_image_injector()
    png_message_decoder()

    append_text_to_jpg()
    get_text_from_jpg()

    append_image_to_jpg()
    get_image_from_jpg()

    append_exe_to_jpg()
    decode_exe_from_jpg()

main()
I fixed the following errors:

Image.size -> image.size
Image.getdata() -> image.getdata()
Image.mode -> image.mode
These changes ensure that the correct methods and attributes are accessed from the Image object.





User
This is my secret message!
b'Hello world '
Traceback (most recent call last):
  File "/home/rafail/Downloads/message_encryption.py", line 139, in <module>
    main()
  File "/home/rafail/Downloads/message_encryption.py", line 134, in main
    get_image_from_jpg()
  File "/home/rafail/Downloads/message_encryption.py", line 103, in get_image_from_jpg
    new_image = Image.open(io.BytesIO(f.read()))
  File "/home/rafail/.local/lib/python3.10/site-packages/PIL/Image.py", line 3298, in open
    raise UnidentifiedImageError(msg)
PIL.UnidentifiedImageError: cannot identify image file <_io.BytesIO object at 0x7fd938498810>
ChatGPT
It seems that there's an error related to identifying the image file in the get_image_from_jpg() function. The error message suggests that the image file being read from f is not recognized as a valid image file.

To fix this issue, please ensure that the photo.jpg file contains a valid image file in JPEG format. Check if the file is corrupted or if it has been modified incorrectly.

Additionally, make sure that the photo2.png file exists in the correct location and is a valid PNG image file. Verify that the file path is accurate and that the file is accessible.

By addressing these i
